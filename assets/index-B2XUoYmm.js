
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{ah as v,f as q,r as u,y as G,ai as B,h as m,aj as z,ak as A,k as o,o as _,c as h,a as l,w as s,i as E,l as M,A as x,B as C,au as J,$ as K,a0 as H,b as Q,_ as W}from"./index-CNoZ28XD.js";import{u as X}from"./tenantMenu-CXTQgFIj.js";import{u as Y}from"./tenantButtonPermission-CVr6n15h.js";const T={list:()=>v.get("/version/get/getVersionList"),detail:n=>v.get("setting/version_management/detail",{params:{id:n},baseURL:"/mock/"}),create:n=>v.post("version/insert/insertVersion",n),edit:n=>v.post("version/update/updateVersion",n),delete:n=>v.delete(`version/delete/deleteVersion/${n}`)},Z={class:"custom-tree-node"},ee={class:"menu"},te={class:"permission"},oe=q({__name:"index",props:["id","row"],setup(n,{expose:S}){const b=n,D=X(),F=Y(),i=u(!1),c=u(),I=u(),y=u([]),g=u([]),d=u([]),t=u({id:b.id,name:"",code:"",remark:"",expirationTime:null,versionMenuId:[],versionButtonId:[]}),P=u({name:[{required:!0,message:"请输入版本",trigger:"blur"}],code:[{required:!0,message:"请输入版本编码",trigger:"blur"}]});G(async()=>{t.value.id!==""&&await R(),y.value=await D.gettenantMenu,g.value=await F.getTenantPermissions,i.value=!1});async function R(){i.value=!0,d.value=JSON.parse(b.row),t.value.name=d.value.name,t.value.remark=d.value.remark,t.value.code=d.value.code,V(d.value.menuVOList.data),U(d.value.buttonVOList),i.value=!1}function V(r){for(const e of r)t.value.versionMenuId.push(e.id),e.children&&V(e.children)}function U(r){for(const e of r)t.value.versionButtonId.push(e.id),e.children&&V(e.children)}function w(r){return g==null?void 0:g.value.filter(e=>r===e.menuId)}return S({submit(){return t.value.versionMenuId=I.value.getCheckedKeys(!1),new Promise(r=>{t.value.id===""?(delete t.value.id,c.value&&c.value.validate(e=>{e&&(i.value=!0,T.create(t.value).then(()=>{B.success({message:"新增成功",center:!0}),i.value=!1,r()}))})):c.value&&c.value.validate(e=>{e&&(i.value=!0,T.edit(t.value).then(()=>{B.success({message:"编辑成功",center:!0}),i.value=!1,r()}))})})}}),(r,e)=>{const k=m("ElInput"),f=m("ElFormItem"),L=m("ElCheckbox"),N=m("ElCheckboxGroup"),O=m("el-tree"),j=m("ElForm"),$=z("loading");return A((_(),h("div",null,[l(j,{ref_key:"formRef",ref:c,model:o(t),rules:o(P),"label-width":"120px","label-suffix":"："},{default:s(()=>[l(f,{label:"版本",prop:"name"},{default:s(()=>[l(k,{modelValue:o(t).name,"onUpdate:modelValue":e[0]||(e[0]=a=>o(t).name=a),placeholder:"请输入版本"},null,8,["modelValue"])]),_:1}),l(f,{label:"版本编码",prop:"code"},{default:s(()=>[l(k,{modelValue:o(t).code,"onUpdate:modelValue":e[1]||(e[1]=a=>o(t).code=a),placeholder:"请输入版本编码"},null,8,["modelValue"])]),_:1}),b.id?M("",!0):(_(),E(f,{key:0,label:"版本时长",prop:"expirationTime"},{default:s(()=>[l(k,{modelValue:o(t).expirationTime,"onUpdate:modelValue":e[2]||(e[2]=a=>o(t).expirationTime=a),modelModifiers:{number:!0},placeholder:"请输入版本编码"},null,8,["modelValue"])]),_:1})),l(f,{label:"备注",prop:"remark"},{default:s(()=>[l(k,{modelValue:o(t).remark,"onUpdate:modelValue":e[3]||(e[3]=a=>o(t).remark=a),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),l(f,{label:"权限"},{default:s(()=>[l(O,{ref_key:"treeRef",ref:I,data:o(y),style:{width:"100%"},"default-checked-keys":o(t).versionMenuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"","default-expand-all":"","highlight-current":"",border:""},{default:s(({data:a})=>[x("div",Z,[x("div",ee,C(a.meta.title),1),x("div",te,[w(a.id).length?(_(),h("div",{key:0,class:"buttonId",onClick:e[5]||(e[5]=J(()=>{},["stop"]))},[l(N,{modelValue:o(t).versionButtonId,"onUpdate:modelValue":e[4]||(e[4]=p=>o(t).versionButtonId=p)},{default:s(()=>[(_(!0),h(K,null,H(w(a.id),p=>(_(),E(L,{key:p.id,value:p.id},{default:s(()=>[Q(C(p.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):M("",!0)])])]),_:1},8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model","rules"])])),[[$,o(i)]])}}}),ae=W(oe,[["__scopeId","data-v-1d99adcb"]]),se=Object.freeze(Object.defineProperty({__proto__:null,default:ae},Symbol.toStringTag,{value:"Module"}));export{ae as D,T as a,se as i};
