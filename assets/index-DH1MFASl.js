
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as C}from"./tenant_tenantPermission-Cs2yZKQ5.js";import{u as T}from"./tenantMenu-CudSKwe9.js";import{f as Y,m as S,q as G,r as b,u as H,g as P,y as Q,h as s,o as m,c as g,a as t,w as u,b as c,k as a,co as W,$ as F,a0 as k,ai as w,i as D,A as B,B as I,_ as X}from"./index-vWDRJyOK.js";const Z={style:{float:"left"}},ee={style:{float:"right","font-size":"13px",color:"var(--el-text-color-secondary)"}},le=Y({__name:"index",props:S(["id","path","keys","row","menulev"],{modelValue:{default:!1},modelModifiers:{}}),emits:S(["success"],["update:modelValue"]),setup(h,{emit:U}){const p=h,A=U,N=T(),$=G("success"),y=b(),e=b({menulev:p.menulev,keys:p.keys||[],menuData:[],choiceMenuData:[],queryForm:{id:p.id||""}}),z=b({menu:[{required:!0,message:"请选择路由地址",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"blur"}],name:[{required:!0,message:"请输入key标识",trigger:"blur"}],label:[{required:!0,message:"请输入名称",trigger:"blur"}]}),q=H(h,"modelValue"),L=P(()=>p.id===""?"新增权限":"编辑权限"),R=b([{value:3,label:"三级导航"},{value:4,label:"内置页面"}]);function f(n,o){const d=[];function v(r){if(Array.isArray(r))for(const i of r)i.menuLevel===o&&d.push(i),Array.isArray(i.children)&&v(i.children)}return v(n),d}function M(n){n===1?e.value.choiceMenuData=f(e.value.menuData,1):n===2?e.value.choiceMenuData=f(e.value.menuData,2):n===3?e.value.choiceMenuData=f(e.value.menuData,3):e.value.choiceMenuData=f(e.value.menuData,4)}function K(n){const o=e.value.choiceMenuData.find(d=>d.path===n);e.value.keys=o.key,e.value.queryForm.menuId=o.id}function j(){e.value.queryForm.permissions=`${e.value.queryForm.menu}-${e.value.queryForm.type}-${e.value.queryForm.name}`,e.value.queryForm.id?y.value&&y.value.validate(n=>{n&&C.edit(e.value.queryForm).then(()=>{w.success({message:"编辑成功",center:!0}),$(),V()})}):y.value.validate(n=>{n&&C.create(e.value.queryForm).then(()=>{w.success({message:"新增成功",center:!0}),A("success"),V()})})}Q(async()=>{e.value.queryForm.id!==""&&(e.value.queryForm=JSON.parse(p.row)),e.value.menuData=await N.gettenantMenu,e.value.choiceMenuData=f(e.value.menuData,e.value.menulev)});function V(){q.value=!1}return(n,o)=>{const d=s("el-option"),v=s("el-select"),r=s("ElFormItem"),i=s("ElSelect"),_=s("el-radio-button"),J=s("el-radio-group"),E=s("ElInput"),x=s("ElButton"),O=s("ElDialog");return m(),g("div",null,[t(O,{modelValue:q.value,"onUpdate:modelValue":o[6]||(o[6]=l=>q.value=l),title:a(L),width:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":""},{footer:u(()=>[t(x,{size:"large",onClick:V},{default:u(()=>[c(" 取消 ")]),_:1}),t(x,{type:"primary",size:"large",onClick:j},{default:u(()=>[c(" 确定 ")]),_:1})]),default:u(()=>[t(a(W),{ref_key:"formRef",ref:y,inline:!0,rules:a(z),model:a(e).queryForm,"label-width":"120px","label-suffix":":"},{default:u(()=>[t(r,{label:"路由等级"},{default:u(()=>[t(v,{modelValue:a(e).menulev,"onUpdate:modelValue":o[0]||(o[0]=l=>a(e).menulev=l),disabled:!!a(e).id,placeholder:"Select",onChange:M},{default:u(()=>[(m(!0),g(F,null,k(a(R),l=>(m(),D(d,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),t(r,{label:"选择路由",prop:"menu"},{default:u(()=>[t(i,{modelValue:a(e).queryForm.menu,"onUpdate:modelValue":o[1]||(o[1]=l=>a(e).queryForm.menu=l),disabled:!!a(e).id,placeholder:"选择路由",onChange:K},{default:u(()=>[(m(!0),g(F,null,k(a(e).choiceMenuData,l=>(m(),D(d,{key:l.id,label:l.meta.title,value:l.path},{default:u(()=>[B("span",Z,I(l.meta.title),1),B("span",ee,I(l.name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),t(r,{label:"类型",prop:"type"},{default:u(()=>[t(J,{modelValue:a(e).queryForm.type,"onUpdate:modelValue":o[2]||(o[2]=l=>a(e).queryForm.type=l)},{default:u(()=>[t(_,{value:"get",label:"get"},{default:u(()=>[c(" 读 ")]),_:1}),t(_,{value:"insert",label:"insert"},{default:u(()=>[c(" 写 ")]),_:1}),t(_,{value:"update",label:"update"},{default:u(()=>[c(" 改 ")]),_:1}),t(_,{value:"delete",label:"delete"},{default:u(()=>[c(" 删 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"对应接口"},{default:u(()=>[t(v,{modelValue:a(e).queryForm.key,"onUpdate:modelValue":o[3]||(o[3]=l=>a(e).queryForm.key=l),disabled:!!a(e).id,placeholder:"Select",onChange:M},{default:u(()=>[(m(!0),g(F,null,k(a(e).keys,l=>(m(),D(d,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),t(r,{label:"权限KEY",prop:"name"},{default:u(()=>[t(E,{modelValue:a(e).queryForm.name,"onUpdate:modelValue":o[4]||(o[4]=l=>a(e).queryForm.name=l)},null,8,["modelValue"])]),_:1}),t(r,{label:"名称",prop:"label"},{default:u(()=>[t(E,{modelValue:a(e).queryForm.label,"onUpdate:modelValue":o[5]||(o[5]=l=>a(e).queryForm.label=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])])}}}),oe=X(le,[["__scopeId","data-v-2d8f67a7"]]);export{oe as default};
