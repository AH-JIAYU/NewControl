
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{f as J,r as i,p as O,aD as A,h as u,aE as Q,ai as W,k as s,o as p,c as V,a as l,w as t,a0 as S,a1 as B,i as w,A as X,B as Z,b as h,a2 as U,x as ee,_ as ae}from"./index-CTklHSgw.js";import{S as le}from"./sortable.esm-BS5toX6s.js";import{a as $}from"./setting_permissions-BVGQgEqs.js";import{a as te}from"./menu-sGXqquFs.js";const ne={class:"index"},oe=J({__name:"index",props:["id","menulev"],setup(x,{expose:F}){const k=x,I=i({menu:[{required:!0,message:"请选择路由地址",trigger:"blur"}]}),y=i(!1),f=i(),E=i(),R=i(0),e=i({id:k.id,menulev:k.menulev,title:"",flat:!1,menu:"",data:[],menuData:[],choiceMenuData:[]}),z=i([{value:1,label:"一级导航"},{value:2,label:"二级导航"},{value:3,label:"三级导航"},{value:4,label:"内置页面"}]);function v(n,o){const r=[];function d(_){if(Array.isArray(_))for(const c of _)c.menuLevel===o&&r.push(c),Array.isArray(c.children)&&d(c.children)}return d(n),r}function L(n){n===1?e.value.choiceMenuData=v(e.value.menuData,1):n===2?e.value.choiceMenuData=v(e.value.menuData,2):n===3?e.value.choiceMenuData=v(e.value.menuData,3):e.value.choiceMenuData=v(e.value.menuData,4)}function T(){const n=E.value.$el.querySelector(".el-table__body-wrapper tbody");le.create(n,{handle:".sortable",animation:300,ghostClass:"ghost",onEnd:({newIndex:o,oldIndex:r})=>{if(o===void 0||r===void 0)return;const d=e.value.data.splice(r,1)[0];e.value.data.splice(o,0,d),R.value+=1,U(()=>T())}})}O(async()=>{T();const n=await te.list({type:"normal"});e.value.menuData=n.data,e.value.choiceMenuData=v(e.value.menuData,e.value.menulev),e.value.id!==""&&N()});function N(){y.value=!0,e.value.data=[{menu:"multilevel_menu_example",type:"write",label:"新增按钮",name:"cs",id:"1",permission:"multilevel_menu_example-write-cs"},{menu:"multilevel_menu_example",type:"edit",label:"编辑按钮",name:"cs2",id:"2",permission:"multilevel_menu_example-create-cs2"}],e.value.flat=!!e.value.data.length,y.value=!1}function q(){e.value.data.push({name:"",value:""}),U(()=>{E.value.setScrollTop(e.value.data.length*50)})}function K(n){e.value.data.splice(n,1)}return F({submit(){return e.value.data.forEach(n=>{n.menu=e.value.menu,n.permission=`${e.value.menu}-${n.type}-${n.name}`}),new Promise(n=>{e.value.flat?f.value&&f.value.validate(o=>{o&&$.edit(e.value.data).then(()=>{A.success({message:"1模拟编辑成功",center:!0}),n()})}):f.value&&f.value.validate(o=>{o&&$.create(e.value.data).then(()=>{A.success({message:"1模拟新增成功",center:!0}),n()})})})}}),(n,o)=>{const r=u("el-option"),d=u("el-select"),_=u("ElFormItem"),c=u("ElSelect"),D=ee,C=u("ElButton"),b=u("ElTableColumn"),P=u("ElTag"),g=u("el-radio-button"),Y=u("el-radio-group"),M=u("ElInput"),j=u("ElTable"),G=u("ElForm"),H=Q("loading");return W((p(),V("div",null,[l(G,{ref_key:"formRef",ref:f,rules:s(I),model:s(e),"label-width":"120px","label-suffix":"："},{default:t(()=>[l(_,{label:"路由等级"},{default:t(()=>[l(d,{modelValue:s(e).menulev,"onUpdate:modelValue":o[0]||(o[0]=a=>s(e).menulev=a),placeholder:"Select",size:"large",style:{width:"240px"},onChange:L},{default:t(()=>[(p(!0),V(S,null,B(s(z),a=>(p(),w(r,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"选择路由",prop:"menu"},{default:t(()=>[l(c,{modelValue:s(e).menu,"onUpdate:modelValue":o[1]||(o[1]=a=>s(e).menu=a),placeholder:"选择路由"},{default:t(()=>[(p(!0),V(S,null,B(s(e).choiceMenuData,a=>(p(),w(r,{key:a.id,label:a.meta.title,value:a.path},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(p(),w(j,{ref_key:"authsTableRef",ref:E,key:x.id,data:s(e).data,stripe:"","highlight-current-row":"",border:""},{default:t(()=>[l(b,{width:"60",align:"center",fixed:""},{header:t(()=>[l(C,{type:"primary",size:"small",circle:"",plain:"",onClick:q},{icon:t(()=>[l(D,{name:"i-ep:plus"})]),_:1})]),default:t(a=>[X("span",ne,Z(a.$index+1),1),l(C,{type:"danger",size:"small",plain:"",circle:"",class:"delete",onClick:m=>K(a.$index)},{icon:t(()=>[l(D,{name:"i-ep:delete"})]),_:2},1032,["onClick"])]),_:1}),l(b,{width:"80",align:"center",fixed:""},{header:t(()=>[h(" 排序 ")]),default:t(()=>[l(P,{type:"info",class:"sortable"},{default:t(()=>[l(D,{name:"i-ep:d-caret"})]),_:1})]),_:1}),l(b,{label:"类型",align:"center"},{default:t(a=>[l(Y,{modelValue:a.row.type,"onUpdate:modelValue":m=>a.row.type=m},{default:t(()=>[l(g,{value:"get",label:"get"},{default:t(()=>[h(" 读 ")]),_:1}),l(g,{value:"insert",label:"insert"},{default:t(()=>[h(" 写 ")]),_:1}),l(g,{value:"update",label:"update"},{default:t(()=>[h(" 改 ")]),_:1}),l(g,{value:"delete",label:"delete"},{default:t(()=>[h(" 删 ")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),l(b,{label:"权限KEY"},{default:t(a=>[l(M,{modelValue:a.row.name,"onUpdate:modelValue":m=>a.row.name=m},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(b,{label:"名称"},{default:t(a=>[l(M,{modelValue:a.row.label,"onUpdate:modelValue":m=>a.row.label=m},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"]))]),_:1},8,["rules","model"])])),[[H,s(y)]])}}}),de=ae(oe,[["__scopeId","data-v-234ecd50"]]);export{de as default};
