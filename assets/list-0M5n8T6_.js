
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as ce}from"./index-BPrLlmEk.js";import{g as de,r as N,q as ue,a1 as R,i as u,s as pe,o as y,c as ve,F as g,a as i,w as l,b as w,t as S,j as z,G as V,au as L,c9 as U,l as b,n as A,cm as x,E as $,M as fe,bG as ge,bE as me,_ as he,d as P}from"./index-8VIcFXwB.js";import _e from"./index-DcAkTWir.js";import ye from"./index-DQujcaMl.js";import{a as C}from"./setting_basisDictionary-DZoy7bqR.js";import{u as be}from"./usePagination-BZQ0LQAA.js";const Ce=D=>(ge("data-v-17079d85"),D=D(),me(),D),De={class:"absolute-container"},Ee={class:"page-main"},ke={class:"custom-tree-node"},Ie=["title"],Ne={class:"code"},we={class:"actions"},Se={class:"dictionary-container"},ze={class:"dictionary-container"},Ve=Ce(()=>g("div",{class:"empty"}," 请在左侧新增或选择一个字典 ",-1)),Le=[Ve],F=de({name:"SettingBasisDictionaryList",__name:"list",setup(D){const B=N(),a=N({search:"",tree:[],currentNode:void 0,currentData:void 0,dialog:{visible:!1,parentId:"",id:""},row:"",loading:!1}),{pagination:p,onSizeChange:J,onCurrentChange:O,onSortChange:j}=be();p.value.size=20,p.value.sizes=[20,50,100];const q=N(),n=N({loading:!1,search:{dictionaryId:"",title:""},dataList:[],selectionDataList:[],row:"",dialog:{visible:!1,id:""}});function E(){a.value.loading=!0,n.value.search.dictionaryId="",C.list().then(e=>{a.value.tree=e.data,a.value.loading=!1})}ue(()=>{E()}),R(()=>a.value.search,e=>{B.value.filter(e)});function H(e,t){return e?t.label.includes(e):!0}function T(e){a.value.currentData=e,a.value.dialog.parentId=(e==null?void 0:e.id)??"",a.value.dialog.id="",a.value.dialog.visible=!0}function K(e,t){a.value.currentNode=e,a.value.currentData=t,a.value.row=JSON.stringify(t),a.value.dialog.parentId=e.parent.data.id??"",a.value.dialog.id=t.id,a.value.dialog.visible=!0}function Q(e,t){x.confirm(`确认删除「${t.chineseName}」吗？`,"确认信息").then(()=>{C.delete(t.id).then(()=>{$.success({message:"删除成功",center:!0});const s=e.parent,r=s.data.children||s.data,c=r.findIndex(v=>v.id===t.id);r.splice(c,1),a.value.tree=[...a.value.tree]})})}function W(e){a.value.currentData?(a.value.currentData.children||(a.value.currentData.children=[]),a.value.currentData.children.push({id:e.id,label:e.label,code:e.code})):a.value.tree.push({id:e.id,label:e.label,code:e.code}),E()}function X(e,t){if(a.value.currentNode&&a.value.currentData)if((a.value.currentNode.parent.data.id??"")===t)a.value.currentData.label=e.label,a.value.currentData.code=e.code;else{const s=a.value.currentNode.parent,r=s.data.children||s.data,c=r.findIndex(v=>v.id===e.id);if(r[c].label=e.label,r[c].code=e.code,t){const v=(m,k)=>{for(const d in m){if(m[d].id===k)return m[d];if(m[d].children){const I=v(m[d].children,k);if(I)return I}}},_=v(a.value.tree,t);_.children||(_.children=[]),_.children.push(r[c])}else a.value.tree.push(r[c]);r.splice(c,1)}E()}function Y(e){p.value.page=1,n.value.search.dictionaryId=e.id}R(()=>n.value.search.dictionaryId,()=>{f()});function f(){n.value.loading=!0,C.itemList(n.value.search.dictionaryId).then(e=>{n.value.loading=!1,n.value.dataList=e.data,n.value.dataList.forEach(t=>{t.enableLoading=!1}),p.value.total=e.data.length})}function Z(e){J(e).then(()=>f())}function ee(e=1){O(e).then(()=>f())}function ae({prop:e,order:t}){j(e,t).then(()=>f())}function te(){n.value.dialog.id="",n.value.dialog.visible=!0}function ie(e){n.value.row=JSON.stringify(e),n.value.dialog.id=e.id,n.value.dialog.visible=!0}function ne(e){x.confirm(`确认删除「${e.chineseName}」吗？`,"确认信息").then(()=>{C.itemDelete(e.id).then(()=>{f(),$.success({message:"删除成功",center:!0})})}).catch(()=>{})}function le(e){x.confirm(`确认删除选中的 ${e.length} 条数据吗？`,"确认信息").then(()=>{C.itemDelete(e.map(t=>t.id)).then(()=>{f(),$.success({message:"删除成功",center:!0})})}).catch(()=>{})}return(e,t)=>{const s=u("ElButton"),r=fe,c=u("ElButtonGroup"),v=u("ElInput"),_=u("ElTree"),m=u("ElScrollbar"),k=u("ElSpace"),d=u("ElTableColumn"),I=u("ElTag"),oe=u("ElTable"),re=u("ElPagination"),se=ce,M=pe("loading");return y(),ve("div",De,[g("div",Ee,[i(se,{"hide-left-side-toggle":""},{leftSide:l(()=>[i(c,{class:"btns"},{default:l(()=>[i(s,{type:"primary",class:"add",onClick:t[0]||(t[0]=o=>T())},{default:l(()=>[w(" 新增字典 ")]),_:1}),i(s,{onClick:E},{icon:l(()=>[i(r,{name:"i-ep:refresh"})]),_:1})]),_:1}),i(v,{modelValue:a.value.search,"onUpdate:modelValue":t[1]||(t[1]=o=>a.value.search=o),placeholder:"请输入关键词筛选字典",clearable:"",class:"search"},null,8,["modelValue"]),i(m,{class:"tree"},{default:l(()=>[S((y(),z(_,{ref_key:"dictionaryRef",ref:B,data:a.value.tree,"filter-node-method":H,"default-expand-all":"",onNodeClick:Y},{default:l(({node:o,data:h})=>[g("div",ke,[g("div",{class:"label",title:o.label},V(h.chineseName),9,Ie),g("div",Ne,V(h.englishName),1),g("div",we,[i(c,null,{default:l(()=>[i(s,{type:"primary",plain:"",size:"default",onClick:L(G=>T(h),["stop"])},{icon:l(()=>[i(r,{name:"i-ep:plus"})]),_:2},1032,["onClick"]),i(s,{type:"info",plain:"",size:"default",onClick:L(G=>K(o,h),["stop"])},{icon:l(()=>[i(r,{name:"i-ep:edit"})]),_:2},1032,["onClick"]),i(s,{type:"danger",plain:"",size:"default",onClick:L(G=>Q(o,h),["stop"])},{icon:l(()=>[i(r,{name:"i-ep:delete"})]),_:2},1032,["onClick"])]),_:2},1024)])])]),_:1},8,["data","filter-node-method"])),[[M,a.value.loading]])]),_:1})]),default:l(()=>[S(g("div",Se,[i(k,{wrap:""},{default:l(()=>[i(s,{type:"primary",onClick:te},{icon:l(()=>[i(r,{name:"i-ep:plus"})]),_:1}),i(s,{type:"danger",disabled:!n.value.selectionDataList.length,onClick:t[2]||(t[2]=o=>le(n.value.selectionDataList))},{icon:l(()=>[i(r,{name:"i-ep:delete"})]),_:1},8,["disabled"]),i(v,{modelValue:n.value.search.title,"onUpdate:modelValue":t[3]||(t[3]=o=>n.value.search.title=o),placeholder:"请输入关键词筛选字典项",clearable:"",style:{width:"200px"}},null,8,["modelValue"]),i(s,{onClick:f},{icon:l(()=>[i(r,{name:"i-ep:search"})]),_:1})]),_:1}),S((y(),z(oe,{ref_key:"dictionaryItemRef",ref:q,data:n.value.dataList,stripe:"","highlight-current-row":"",border:"",height:"100%",onSortChange:ae,onSelectionChange:t[4]||(t[4]=o=>n.value.selectionDataList=o)},{default:l(()=>[i(d,{type:"selection",align:"center",fixed:""}),i(d,{prop:"chineseName",label:"中文名称"}),i(d,{prop:"englishName",label:"英文名称"}),i(d,{label:"键值",align:"center",width:"150"},{default:l(o=>[i(I,{type:"info"},{default:l(()=>[w(V(o.row.code),1)]),_:2},1024)]),_:1}),i(d,{label:"操作",width:"200",align:"center"},{default:l(o=>[i(s,{type:"primary",size:"small",plain:"",onClick:h=>ie(o.row)},{default:l(()=>[w(" 编辑 ")]),_:2},1032,["onClick"]),i(s,{type:"danger",size:"small",plain:"",onClick:h=>ne(o.row)},{default:l(()=>[w(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[M,n.value.loading]]),i(re,{"current-page":b(p).page,total:b(p).total,"page-size":b(p).size,"page-sizes":b(p).sizes,layout:b(p).layout,"hide-on-single-page":!1,class:"pagination",background:"",onSizeChange:Z,onCurrentChange:ee},null,8,["current-page","total","page-size","page-sizes","layout"])],512),[[U,n.value.search.dictionaryId]]),S(g("div",ze,Le,512),[[U,!n.value.search.dictionaryId]])]),_:1}),a.value.dialog.visible?(y(),z(_e,{key:0,id:a.value.dialog.id,modelValue:a.value.dialog.visible,"onUpdate:modelValue":t[5]||(t[5]=o=>a.value.dialog.visible=o),row:a.value.row,"parent-id":a.value.dialog.parentId,tree:a.value.tree,onAddNode:W,onEditNode:X},null,8,["id","modelValue","row","parent-id","tree"])):A("",!0),n.value.dialog.visible?(y(),z(ye,{key:1,id:n.value.dialog.id,modelValue:n.value.dialog.visible,"onUpdate:modelValue":t[6]||(t[6]=o=>n.value.dialog.visible=o),"dictionary-id":n.value.search.dictionaryId,tree:a.value.tree,row:n.value.row,onSuccess:f},null,8,["id","modelValue","dictionary-id","tree","row"])):A("",!0)])])}}});typeof P=="function"&&P(F);const Re=he(F,[["__scopeId","data-v-17079d85"]]);export{Re as default};
