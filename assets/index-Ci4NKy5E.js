
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{f as G,r as u,y as j,ak as y,h as i,ai as A,aj as J,k as o,o as p,c as b,a as l,w as s,i as w,l as B,A as h,B as E,au as K,$,a0 as z,b as H,_ as Q}from"./index-CUpiA7PJ.js";import{a as M}from"./setting_versionManagement-CNejTK9b.js";import{u as W}from"./tenantMenu--IPb4Hb1.js";import{u as X}from"./tenantButtonPermission-DX-lod3N.js";import"./tenant_tenantPermission-mM4BV3xy.js";const Y={class:"custom-tree-node"},Z={class:"menu"},ee={class:"permission"},te=G({__name:"index",props:["id","row"],setup(C,{expose:T}){const k=C,F=W(),D=X(),n=u(!1),m=u(),V=u(),x=u([]),v=u([]),d=u([]),t=u({id:k.id,name:"",code:"",remark:"",expirationTime:null,versionMenuId:[],versionButtonId:[]}),N=u({name:[{required:!0,message:"请输入版本",trigger:"blur"}],code:[{required:!0,message:"请输入版本编码",trigger:"blur"}]});j(async()=>{t.value.id!==""&&await P(),n.value=!0,x.value=await F.gettenantMenu,v.value=await D.getTenantPermissions,n.value=!1});async function P(){n.value=!0,d.value=JSON.parse(k.row),t.value.name=d.value.name,t.value.remark=d.value.remark,t.value.code=d.value.code,g(d.value.menuVOList.data),R(d.value.buttonVOList),n.value=!1}function g(r){for(const e of r)t.value.versionMenuId.push(e.id),e.children&&g(e.children)}function R(r){for(const e of r)t.value.versionButtonId.push(e.id),e.children&&g(e.children)}function I(r){return v==null?void 0:v.value.filter(e=>r===e.menuId)}return T({submit(){return t.value.versionMenuId=V.value.getCheckedKeys(!1),new Promise(r=>{t.value.id===""?(delete t.value.id,m.value&&m.value.validate(e=>{e&&(n.value=!0,M.create(t.value).then(()=>{y.success({message:"新增成功",center:!0}),n.value=!1,r()}))})):m.value&&m.value.validate(e=>{e&&(n.value=!0,M.edit(t.value).then(()=>{y.success({message:"编辑成功",center:!0}),n.value=!1,r()}))})})}}),(r,e)=>{const _=i("ElInput"),c=i("ElFormItem"),S=i("ElCheckbox"),U=i("ElCheckboxGroup"),L=i("el-tree"),O=i("ElForm"),q=A("loading");return J((p(),b("div",null,[l(O,{ref_key:"formRef",ref:m,model:o(t),rules:o(N),"label-width":"120px","label-suffix":"："},{default:s(()=>[l(c,{label:"版本",prop:"name"},{default:s(()=>[l(_,{modelValue:o(t).name,"onUpdate:modelValue":e[0]||(e[0]=a=>o(t).name=a),placeholder:"请输入版本"},null,8,["modelValue"])]),_:1}),l(c,{label:"版本编码",prop:"code"},{default:s(()=>[l(_,{modelValue:o(t).code,"onUpdate:modelValue":e[1]||(e[1]=a=>o(t).code=a),placeholder:"请输入版本编码"},null,8,["modelValue"])]),_:1}),k.id?B("",!0):(p(),w(c,{key:0,label:"版本时长",prop:"expirationTime"},{default:s(()=>[l(_,{modelValue:o(t).expirationTime,"onUpdate:modelValue":e[2]||(e[2]=a=>o(t).expirationTime=a),modelModifiers:{number:!0},placeholder:"请输入版本编码"},null,8,["modelValue"])]),_:1})),l(c,{label:"备注",prop:"remark"},{default:s(()=>[l(_,{modelValue:o(t).remark,"onUpdate:modelValue":e[3]||(e[3]=a=>o(t).remark=a),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),l(c,{label:"权限"},{default:s(()=>[l(L,{ref_key:"treeRef",ref:V,data:o(x),style:{width:"100%"},"default-checked-keys":o(t).versionMenuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"","default-expand-all":"","highlight-current":"",border:""},{default:s(({data:a})=>[h("div",Y,[h("div",Z,E(a.meta.title),1),h("div",ee,[I(a.id).length?(p(),b("div",{key:0,class:"buttonId",onClick:e[5]||(e[5]=K(()=>{},["stop"]))},[l(U,{modelValue:o(t).versionButtonId,"onUpdate:modelValue":e[4]||(e[4]=f=>o(t).versionButtonId=f)},{default:s(()=>[(p(!0),b($,null,z(I(a.id),f=>(p(),w(S,{key:f.id,value:f.id},{default:s(()=>[H(E(f.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):B("",!0)])])]),_:1},8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model","rules"])])),[[q,o(n)]])}}}),se=Q(te,[["__scopeId","data-v-88033423"]]);export{se as default};
