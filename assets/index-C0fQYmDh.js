
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as b}from"./setting_role-DqYM9KqI.js";import{d as G,cE as M,r as s,t as U,ak as y,a,ai as q,aj as J,i as o,o as f,b as p,f as l,w as r,x as _,y as w,Y as K,Z as L,j as O,e as T,g as Y,I as Z}from"./index-NBWyYRod.js";import{u as z}from"./buttonPermission-D-WXkMHI.js";import"./setting_permissions-Cxl-6bjP.js";const A={class:"custom-tree-node"},H={class:"menu"},Q={class:"permission"},W={key:0,class:"permissions"},X=G({__name:"index",props:["id","row"],setup(E,{expose:I}){const v=E,V=M(),C=z(),n=s(!1),u=s(),k=s(),h=s([]),m=s([]),e=s({id:v.id??null,menuId:[],permissions:[],roleName:"",remark:""}),N=s({role:[{required:!0,message:"请输入角色吗",trigger:"blur"}]});U(async()=>{e.value.id!==""&&await R(),n.value=!0,h.value=V.routesRaw,m.value=await C.getPermissions,n.value=!1});async function R(){n.value=!0,e.value=JSON.parse(v.row),n.value=!1}function g(i){return m==null?void 0:m.value.filter(t=>i===t.menuId)}return I({submit(){return e.value.menuId=k.value.getCheckedKeys(!1),new Promise(i=>{e.value.id===""?u.value&&u.value.validate(t=>{t&&b.create(e.value).then(()=>{y.success({message:"新增成功",center:!0}),i()})}):u.value&&u.value.validate(t=>{t&&b.edit(e.value).then(()=>{y.success({message:"编辑成功",center:!0}),i()})})})}}),(i,t)=>{const F=a("ElInput"),x=a("ElFormItem"),B=a("ElCheckbox"),P=a("ElCheckboxGroup"),D=a("el-tree"),S=a("ElForm"),j=q("loading");return J((f(),p("div",null,[l(S,{ref_key:"formRef",ref:u,model:o(e),rules:o(N),"label-width":"120px","label-suffix":"："},{default:r(()=>[l(x,{label:"角色码",prop:"roleName"},{default:r(()=>[l(F,{modelValue:o(e).roleName,"onUpdate:modelValue":t[0]||(t[0]=d=>o(e).roleName=d),placeholder:"请输入角色码"},null,8,["modelValue"])]),_:1}),l(x,{label:"权限"},{default:r(()=>[l(D,{ref_key:"treeRef",ref:k,data:o(h),style:{width:"100%"},"default-checked-keys":o(e).menuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"","default-expand-all":"","highlight-current":"",border:""},{default:r(({data:d})=>[_("div",A,[_("div",H,w(d.meta.title),1),_("div",Q,[g(d.id).length?(f(),p("div",W,[l(P,{modelValue:o(e).permissions,"onUpdate:modelValue":t[1]||(t[1]=c=>o(e).permissions=c)},{default:r(()=>[(f(!0),p(K,null,L(g(d.id),c=>(f(),T(B,{key:c.id,value:c.id},{default:r(()=>[Y(w(c.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):O("",!0)])])]),_:1},8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model","rules"])])),[[j,o(n)]])}}}),se=Z(X,[["__scopeId","data-v-970c00a7"]]);export{se as default};
