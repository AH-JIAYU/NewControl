
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{d as q,r as d,t as G,as as J,ak as E,a as m,ai as K,aj as Y,i as o,o as c,b,f as n,w as s,e as x,j as V,x as h,y as M,au as Z,Y as z,Z as A,g as H,I as Q}from"./index-CS0OZ-B6.js";import{a as B}from"./setting_versionManagement-DV9jU3mi.js";import{u as W}from"./tenantMenu-CcuFbrnr.js";import{u as X}from"./tenantButtonPermission-Cb2_f4ro.js";import"./tenant_tenantMenu-Pvgu2E8U.js";import"./tenant_tenantPermission-D7U6QXAN.js";const $={class:"custom-tree-node"},ee={class:"menu"},te={class:"permission"},oe=q({__name:"index",props:["id","row"],setup(C,{expose:T}){const k=C,D=W(),F=X(),r=d(!1),f=d(),I=d(),y=d([]),_=d([]),i=d([]),t=d({id:k.id,name:"",code:"",remark:"",expirationTime:null,versionMenuId:[],versionButtonId:[]}),N=d({name:[{required:!0,message:"请输入版本",trigger:"blur"}],code:[{required:!0,message:"请输入版本编码",trigger:"blur"}]});G(async()=>{t.value.id!==""&&await P(),r.value=!0,y.value=await D.gettenantMenu,_.value=await F.getTenantPermissions,r.value=!1});async function P(){r.value=!0,i.value=JSON.parse(k.row),t.value.name=i.value.name,t.value.remark=i.value.remark,t.value.code=i.value.code,g(i.value.menuVOList.data),R(i.value.buttonVOList),r.value=!1}function g(a){for(const e of a)t.value.versionMenuId.push(e.id),e.children&&g(e.children)}function R(a){for(const e of a)t.value.versionButtonId.push(e.id),e.children&&g(e.children)}function w(a){return _==null?void 0:_.value.filter(e=>a===e.menuId)}return T({submit(){const a=J(t.value);return a.type=1,a.versionMenuId=I.value.getCheckedKeys(!1),new Promise(e=>{a.id===""?(delete a.id,f.value&&f.value.validate(u=>{u&&(r.value=!0,B.create(a).then(()=>{E.success({message:"新增成功",center:!0}),r.value=!1,e()}))})):f.value&&f.value.validate(u=>{u&&(r.value=!0,B.edit(a).then(()=>{E.success({message:"编辑成功",center:!0}),r.value=!1,e()}))})})}}),(a,e)=>{const u=m("ElInput"),p=m("ElFormItem"),S=m("ElCheckbox"),U=m("ElCheckboxGroup"),L=m("el-tree"),O=m("ElForm"),j=K("loading");return Y((c(),b("div",null,[n(O,{ref_key:"formRef",ref:f,model:o(t),rules:o(N),"label-width":"120px","label-suffix":"："},{default:s(()=>[n(p,{label:"版本",prop:"name"},{default:s(()=>[n(u,{modelValue:o(t).name,"onUpdate:modelValue":e[0]||(e[0]=l=>o(t).name=l),placeholder:"请输入版本"},null,8,["modelValue"])]),_:1}),n(p,{label:"版本编码",prop:"code"},{default:s(()=>[n(u,{modelValue:o(t).code,"onUpdate:modelValue":e[1]||(e[1]=l=>o(t).code=l),placeholder:"请输入版本编码"},null,8,["modelValue"])]),_:1}),k.id?V("",!0):(c(),x(p,{key:0,label:"版本时长",prop:"expirationTime"},{default:s(()=>[n(u,{modelValue:o(t).expirationTime,"onUpdate:modelValue":e[2]||(e[2]=l=>o(t).expirationTime=l),modelModifiers:{number:!0},placeholder:"请输入版本编码"},null,8,["modelValue"])]),_:1})),n(p,{label:"备注",prop:"remark"},{default:s(()=>[n(u,{modelValue:o(t).remark,"onUpdate:modelValue":e[3]||(e[3]=l=>o(t).remark=l),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),n(p,{label:"权限"},{default:s(()=>[o(t).versionMenuId?(c(),x(L,{key:0,ref_key:"treeRef",ref:I,data:o(y),style:{width:"100%"},"default-checked-keys":o(t).versionMenuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"","default-expand-all":"","highlight-current":"",border:""},{default:s(({data:l})=>[h("div",$,[h("div",ee,M(l.meta.title),1),h("div",te,[w(l.id).length?(c(),b("div",{key:0,class:"buttonId",onClick:e[5]||(e[5]=Z(()=>{},["stop"]))},[n(U,{modelValue:o(t).versionButtonId,"onUpdate:modelValue":e[4]||(e[4]=v=>o(t).versionButtonId=v)},{default:s(()=>[(c(!0),b(z,null,A(w(l.id),v=>(c(),x(S,{key:v.id,value:v.id},{default:s(()=>[H(M(v.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):V("",!0)])])]),_:1},8,["data","default-checked-keys"])):V("",!0)]),_:1})]),_:1},8,["model","rules"])])),[[j,o(r)]])}}}),de=Q(oe,[["__scopeId","data-v-5e767fda"]]);export{de as default};
