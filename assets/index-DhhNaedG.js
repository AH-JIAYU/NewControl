
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{a as C}from"./tenant_tenantPermission-SFon8lbY.js";import{u as G}from"./tenantMenu-BMrK-q7J.js";import{f as H,m as S,r as y,q as P,u as Q,g as W,y as X,h as s,ai as Z,o as i,c as g,aj as ee,k as a,i as q,w as t,a as o,b as c,$ as D,a0 as h,co as le,ak as B,A as I,B as U,_ as ae}from"./index-TNcU_1PK.js";const te={style:{float:"left"}},ue={style:{float:"right","font-size":"13px",color:"var(--el-text-color-secondary)"}},oe=H({__name:"index",props:S(["id","path","keys","row","menulev"],{modelValue:{default:!1},modelModifiers:{}}),emits:S(["success"],["update:modelValue"]),setup(M,{emit:A}){const V=y(!1),f=M,N=A,$=G(),z=P("success"),_=y(),e=y({menulev:f.menulev,keys:f.keys||[],menuData:[],choiceMenuData:[],queryForm:{id:f.id||""}}),L=y({menu:[{required:!0,message:"请选择路由地址",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"blur"}],name:[{required:!0,message:"请输入key标识",trigger:"blur"}],label:[{required:!0,message:"请输入名称",trigger:"blur"}]}),F=Q(M,"modelValue"),R=W(()=>f.id===""?"新增权限":"编辑权限"),j=y([{value:3,label:"三级导航"},{value:4,label:"内置页面"}]);function p(n,u){const d=[];function v(r){if(Array.isArray(r))for(const m of r)m.menuLevel===u&&d.push(m),Array.isArray(m.children)&&v(m.children)}return v(n),d}function E(n){n===1?e.value.choiceMenuData=p(e.value.menuData,1):n===2?e.value.choiceMenuData=p(e.value.menuData,2):n===3?e.value.choiceMenuData=p(e.value.menuData,3):e.value.choiceMenuData=p(e.value.menuData,4)}function K(n){const u=e.value.choiceMenuData.find(d=>d.path===n);e.value.keys=u.key,e.value.queryForm.menuId=u.id}function J(){e.value.queryForm.permissions=`${e.value.queryForm.menu}-${e.value.queryForm.type}-${e.value.queryForm.name}`,e.value.queryForm.id?_.value&&_.value.validate(n=>{n&&C.edit(e.value.queryForm).then(()=>{B.success({message:"编辑成功",center:!0}),z(),k()})}):_.value.validate(n=>{n&&(V.value=!0,C.create(e.value.queryForm).then(()=>{B.success({message:"新增成功",center:!0}),N("success"),k(),V.value=!1}))})}X(async()=>{e.value.queryForm.id!==""&&(e.value.queryForm=JSON.parse(f.row)),e.value.menuData=await $.gettenantMenu,e.value.choiceMenuData=p(e.value.menuData,e.value.menulev)});function k(){F.value=!1}return(n,u)=>{const d=s("el-option"),v=s("el-select"),r=s("ElFormItem"),m=s("ElSelect"),b=s("el-radio-button"),O=s("el-radio-group"),x=s("ElInput"),w=s("ElButton"),T=s("ElDialog"),Y=Z("loading");return i(),g("div",null,[ee((i(),q(T,{modelValue:F.value,"onUpdate:modelValue":u[6]||(u[6]=l=>F.value=l),title:a(R),width:"60%","close-on-click-modal":!1,"append-to-body":"","destroy-on-close":""},{footer:t(()=>[o(w,{size:"large",onClick:k},{default:t(()=>[c(" 取消 ")]),_:1}),o(w,{type:"primary",size:"large",onClick:J},{default:t(()=>[c(" 确定 ")]),_:1})]),default:t(()=>[o(a(le),{ref_key:"formRef",ref:_,inline:!0,rules:a(L),model:a(e).queryForm,"label-width":"120px","label-suffix":":"},{default:t(()=>[o(r,{label:"路由等级"},{default:t(()=>[o(v,{modelValue:a(e).menulev,"onUpdate:modelValue":u[0]||(u[0]=l=>a(e).menulev=l),disabled:!!a(e).id,placeholder:"Select",onChange:E},{default:t(()=>[(i(!0),g(D,null,h(a(j),l=>(i(),q(d,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),o(r,{label:"选择路由",prop:"menu"},{default:t(()=>[o(m,{modelValue:a(e).queryForm.menu,"onUpdate:modelValue":u[1]||(u[1]=l=>a(e).queryForm.menu=l),disabled:!!a(e).id,placeholder:"选择路由",onChange:K},{default:t(()=>[(i(!0),g(D,null,h(a(e).choiceMenuData,l=>(i(),q(d,{key:l.id,label:l.meta.title,value:l.path},{default:t(()=>[I("span",te,U(l.meta.title),1),I("span",ue,U(l.name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),o(r,{label:"类型",prop:"type"},{default:t(()=>[o(O,{modelValue:a(e).queryForm.type,"onUpdate:modelValue":u[2]||(u[2]=l=>a(e).queryForm.type=l)},{default:t(()=>[o(b,{value:"get",label:"get"},{default:t(()=>[c(" 读 ")]),_:1}),o(b,{value:"insert",label:"insert"},{default:t(()=>[c(" 写 ")]),_:1}),o(b,{value:"update",label:"update"},{default:t(()=>[c(" 改 ")]),_:1}),o(b,{value:"delete",label:"delete"},{default:t(()=>[c(" 删 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(r,{label:"对应接口"},{default:t(()=>[o(v,{modelValue:a(e).queryForm.key,"onUpdate:modelValue":u[3]||(u[3]=l=>a(e).queryForm.key=l),disabled:!!a(e).id,placeholder:"Select",onChange:E},{default:t(()=>[(i(!0),g(D,null,h(a(e).keys,l=>(i(),q(d,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),o(r,{label:"权限KEY",prop:"name"},{default:t(()=>[o(x,{modelValue:a(e).queryForm.name,"onUpdate:modelValue":u[4]||(u[4]=l=>a(e).queryForm.name=l)},null,8,["modelValue"])]),_:1}),o(r,{label:"名称",prop:"label"},{default:t(()=>[o(x,{modelValue:a(e).queryForm.label,"onUpdate:modelValue":u[5]||(u[5]=l=>a(e).queryForm.label=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])),[[Y,a(V)]])])}}}),de=ae(oe,[["__scopeId","data-v-3caa1204"]]);export{de as default};
