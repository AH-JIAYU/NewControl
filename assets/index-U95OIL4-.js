
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{f as W,r as i,q as X,ao as U,h as s,ap as Z,ai as j,k as o,o as f,c as w,a as l,w as t,a0 as B,a1 as q,i as k,p as $,H as T,b as h,a2 as F,y as ee,_ as ae}from"./index-DEkb9qM_.js";import{S as le}from"./sortable.esm-BS5toX6s.js";import{a as I}from"./setting_permissions-BCPo_SsI.js";import{a as te}from"./menu-CQf6QKmq.js";const ne={style:{float:"left"}},oe={style:{float:"right","font-size":"13px",color:"var(--el-text-color-secondary)"}},ue={class:"index"},re=W({__name:"index",props:["id","menulev","path","auths"],setup(C,{expose:R}){const g=C,y=i({menu:[{required:!0,message:"请选择路由地址",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"blur"}],name:[{required:!0,message:"请输入key标识",trigger:"blur"}],label:[{required:!0,message:"请输入名称",trigger:"blur"}]}),V=i(!1),_=i(),D=i(),z=i(0),e=i({id:g.id,menulev:g.menulev,title:"",flat:!1,menu:"",data:[],menuData:[],choiceMenuData:[]}),N=i([{value:3,label:"三级导航"},{value:4,label:"内置页面"}]);function v(n,u){const r=[];function c(d){if(Array.isArray(d))for(const m of d)m.menuLevel===u&&r.push(m),Array.isArray(m.children)&&c(m.children)}return c(n),r}function L(n){n===1?e.value.choiceMenuData=v(e.value.menuData,1):n===2?e.value.choiceMenuData=v(e.value.menuData,2):n===3?e.value.choiceMenuData=v(e.value.menuData,3):e.value.choiceMenuData=v(e.value.menuData,4)}function M(){const n=D.value.$el.querySelector(".el-table__body-wrapper tbody");le.create(n,{handle:".sortable",animation:300,ghostClass:"ghost",onEnd:({newIndex:u,oldIndex:r})=>{if(u===void 0||r===void 0)return;const c=e.value.data.splice(r,1)[0];e.value.data.splice(u,0,c),z.value+=1,F(()=>M())}})}X(async()=>{M();const n=await te.list({type:"normal"});e.value.menuData=n.data,e.value.choiceMenuData=v(e.value.menuData,e.value.menulev),e.value.id!==""&&K()});function K(){V.value=!0,e.value.data=JSON.parse(g.auths),e.value.menu=g.path,e.value.flat=!!e.value.data.length,V.value=!1}function H(){e.value.data.push({name:"",value:""}),F(()=>{D.value.setScrollTop(e.value.data.length*50)})}function J(n){e.value.data.splice(n,1)}return R({submit(){return e.value.data.forEach(n=>{n.menu=e.value.menu,n.permission=`${e.value.menu}-${n.type}-${n.name}`}),new Promise((n,u)=>{e.value.flat?_.value&&_.value.validate(r=>{r?I.edit(e.value.data).then(()=>{U.success({message:"模拟编辑成功",center:!0}),n()}):u()}):_.value&&_.value.validate(r=>{r?I.create(e.value.data).then(()=>{U.success({message:"模拟新增成功",center:!0}),n()}):u()})})}}),(n,u)=>{const r=s("el-option"),c=s("el-select"),d=s("ElFormItem"),m=s("ElSelect"),x=ee,S=s("ElButton"),b=s("ElTableColumn"),O=s("ElTag"),E=s("el-radio-button"),P=s("el-radio-group"),A=s("ElInput"),Y=s("ElTable"),G=s("ElForm"),Q=Z("loading");return j((f(),w("div",null,[l(G,{ref_key:"formRef",ref:_,rules:o(y),model:o(e),"label-width":"120px","label-suffix":"："},{default:t(()=>[l(d,{label:"路由等级"},{default:t(()=>[l(c,{modelValue:o(e).menulev,"onUpdate:modelValue":u[0]||(u[0]=a=>o(e).menulev=a),placeholder:"Select",size:"large",style:{width:"240px"},onChange:L},{default:t(()=>[(f(!0),w(B,null,q(o(N),a=>(f(),k(r,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"选择路由",prop:"menu"},{default:t(()=>[l(m,{modelValue:o(e).menu,"onUpdate:modelValue":u[1]||(u[1]=a=>o(e).menu=a),placeholder:"选择路由"},{default:t(()=>[(f(!0),w(B,null,q(o(e).choiceMenuData,a=>(f(),k(r,{key:a.id,label:a.meta.title,value:a.path},{default:t(()=>[$("span",ne,T(a.meta.title),1),$("span",oe,T(a.name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(f(),k(Y,{ref_key:"authsTableRef",ref:D,key:C.id,data:o(e).data,stripe:"","highlight-current-row":"",border:""},{default:t(()=>[l(b,{width:"60",align:"center",fixed:""},{header:t(()=>[l(S,{type:"primary",size:"small",circle:"",plain:"",onClick:H},{icon:t(()=>[l(x,{name:"i-ep:plus"})]),_:1})]),default:t(a=>[$("span",ue,T(a.$index+1),1),l(S,{type:"danger",size:"small",plain:"",circle:"",class:"delete",onClick:p=>J(a.$index)},{icon:t(()=>[l(x,{name:"i-ep:delete"})]),_:2},1032,["onClick"])]),_:1}),l(b,{width:"80",align:"center",fixed:""},{header:t(()=>[h(" 排序 ")]),default:t(()=>[l(O,{type:"info",class:"sortable"},{default:t(()=>[l(x,{name:"i-ep:d-caret"})]),_:1})]),_:1}),l(b,{label:"类型",align:"center"},{default:t(a=>[l(d,{prop:`data.${a.$index}.type`,rules:o(y).type},{default:t(()=>[l(P,{modelValue:a.row.type,"onUpdate:modelValue":p=>a.row.type=p},{default:t(()=>[l(E,{value:"get",label:"get"},{default:t(()=>[h(" 读 ")]),_:1}),l(E,{value:"insert",label:"insert"},{default:t(()=>[h(" 写 ")]),_:1}),l(E,{value:"update",label:"update"},{default:t(()=>[h(" 改 ")]),_:1}),l(E,{value:"delete",label:"delete"},{default:t(()=>[h(" 删 ")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1}),l(b,{label:"权限KEY"},{default:t(a=>[l(d,{prop:`data.${a.$index}.name`,rules:o(y).name},{default:t(()=>[l(A,{modelValue:a.row.name,"onUpdate:modelValue":p=>a.row.name=p},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1}),l(b,{label:"名称"},{default:t(a=>[l(d,{prop:`data.${a.$index}.label`,rules:o(y).label},{default:t(()=>[l(A,{modelValue:a.row.label,"onUpdate:modelValue":p=>a.row.label=p},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1})]),_:1},8,["data"]))]),_:1},8,["rules","model"])])),[[Q,o(V)]])}}}),me=ae(re,[["__scopeId","data-v-16f6d5e5"]]);export{me as default};
