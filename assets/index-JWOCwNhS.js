
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{f as v,g as j,r as l,q as G,E,i as d,s as q,t as $,l as o,o as _,c as h,a as r,w as u,F as b,G as B,au as z,a4 as J,a5 as K,n as A,j as H,b as Q,_ as W}from"./index-zX-UbP25.js";import{u as X}from"./tenantMenu-D1ik0fKX.js";import{u as Y}from"./tenantButtonPermission-DRuEzbYa.js";const M={list:()=>v.get("/version/get/getVersionList"),detail:n=>v.get("setting/version_management/detail",{params:{id:n},baseURL:"/mock/"}),create:n=>v.post("version/insert/insertVersion",n),edit:n=>v.post("version/update/updateVersion",n),delete:n=>v.delete(`version/delete/deleteVersion/${n}`)},Z={class:"custom-tree-node"},ee={class:"menu"},te={class:"permission"},oe=j({__name:"index",props:["id","row"],setup(n,{expose:C}){const V=n,F=X(),S=Y(),s=l(!1),c=l(),I=l(),x=l([]),p=l([]),m=l([]),t=l({id:V.id,name:"",code:"",versionMenuId:[],versionButtonId:[]}),D=l({name:[{required:!0,message:"请输入版本",trigger:"blur"}]});G(async()=>{t.value.id!==""&&await P(),x.value=await F.gettenantMenu,p.value=await S.getTenantPermissions,s.value=!1});async function P(){s.value=!0,m.value=JSON.parse(V.row),t.value.name=m.value.name,t.value.remark=m.value.remark,g(m.value.menuVOList.data),R(m.value.buttonVOList),s.value=!1}function g(a){for(const e of a)t.value.versionMenuId.push(e.id),e.children&&g(e.children)}function R(a){for(const e of a)t.value.versionButtonId.push(e.id),e.children&&g(e.children)}function y(a){return p==null?void 0:p.value.filter(e=>a===e.menuId)}return C({submit(){return t.value.versionMenuId=I.value.getCheckedKeys(!1),new Promise(a=>{t.value.id===""?c.value&&c.value.validate(e=>{e&&(s.value=!0,M.create(t.value).then(()=>{E.success({message:"新增成功",center:!0}),s.value=!1,a()}))}):c.value&&c.value.validate(e=>{e&&(s.value=!0,M.edit(t.value).then(()=>{E.success({message:"编辑成功",center:!0}),s.value=!1,a()}))})})}}),(a,e)=>{const w=d("ElInput"),k=d("ElFormItem"),L=d("ElCheckbox"),N=d("ElCheckboxGroup"),O=d("el-tree"),T=d("ElForm"),U=q("loading");return $((_(),h("div",null,[r(T,{ref_key:"formRef",ref:c,model:o(t),rules:o(D),"label-width":"120px","label-suffix":"："},{default:u(()=>[r(k,{label:"版本",prop:"name"},{default:u(()=>[r(w,{modelValue:o(t).name,"onUpdate:modelValue":e[0]||(e[0]=i=>o(t).name=i),placeholder:"请输入版本"},null,8,["modelValue"])]),_:1}),r(k,{label:"版本编码",prop:"name"},{default:u(()=>[r(w,{modelValue:o(t).code,"onUpdate:modelValue":e[1]||(e[1]=i=>o(t).code=i),placeholder:"请输入版本编码"},null,8,["modelValue"])]),_:1}),r(k,{label:"权限"},{default:u(()=>[r(O,{ref_key:"treeRef",ref:I,data:o(x),style:{width:"100%"},"default-checked-keys":o(t).versionMenuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"","default-expand-all":"","highlight-current":"",border:""},{default:u(({data:i})=>[b("div",Z,[b("div",ee,B(i.meta.title),1),b("div",te,[y(i.id).length?(_(),h("div",{key:0,class:"buttonId",onClick:e[3]||(e[3]=z(()=>{},["stop"]))},[r(N,{modelValue:o(t).versionButtonId,"onUpdate:modelValue":e[2]||(e[2]=f=>o(t).versionButtonId=f)},{default:u(()=>[(_(!0),h(J,null,K(y(i.id),f=>(_(),H(L,{key:f.id,value:f.id},{default:u(()=>[Q(B(f.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):A("",!0)])])]),_:1},8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model","rules"])])),[[U,o(s)]])}}}),ne=W(oe,[["__scopeId","data-v-df72562e"]]),re=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"}));export{ne as D,M as a,re as i};
