
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{_ as V,p as y,b as z,a as M,c as N,d as C,u as D,e as F}from"./homePage-CVFNVL2h.js";import{a as m}from"./tenant_tenantHomepageSetting-C7b8Zo56.js";import{d as S,X as B,r as u,a as f,i,o as T,e as A,w as r,f as p,g,x as O,j as P,$ as j,ak as v}from"./index-BF0CLg3s.js";const J=S({__name:"index",emits:["fetch-data"],setup(E,{expose:_,emit:b}){const h=b,e=B({title:"",dialogFormVisible:!1,form:{}}),t=u(null),d=u(null),w=a=>{e.title="编辑",e.form=a,e.dialogFormVisible=!0},x=async()=>{await j(),t.value=V.init({container:d.value,height:"100vh",width:"100%",plugins:[y,z,M,N],i18n:{locale:"zh",messages:{zh:C}},projectData:JSON.parse(e.form.rawData||"{}"),storageManager:!1,deviceManager:{devices:[{id:"desktop",name:"Desktop",width:""},{id:"tablet",name:"Tablet",width:"768px",widthMedia:"992px"},{id:"mobilePortrait",name:"Mobile portrait",width:"320px",widthMedia:"575px"}]},assetManager:{uploadFile:async a=>{const o=a.target.files[0];if(o)try{if(console.log(256e3,"maxSize"),console.log(o,"file"),console.log(Number(o.size),"Number(file.size)"),Number(o.size)>256e3){v.warning({message:"文件大小不能超过 250KB",center:!0});return}else{const l=new FormData;l.append("file",o),l.append("id",e.form.id),m.uploadHomePageTemplateImage(l).then(c=>{t.value.AssetManager.add(c.data)})}}catch(s){console.error("Image upload failed",s)}}}}),t.value.on("block:custom",a=>{D(a.blocks)}),F.forEach(a=>{t.value.Blocks.add(a.id,a)}),t.value.on("asset:remove",a=>{t.value.AssetManager.getAll().find(s=>s.get("src")===a.id)&&t.value.AssetManager.remove(a)})},k=async()=>{const a=t.value.getHtml(),o=t.value.getCss(),s=JSON.stringify(t.value.getProjectData());e.form={...e.form,html:a,css:o,rawData:s};const{status:l}=await m.edit(e.form);l===1&&v.success({message:"编辑成功",center:!0}),h("fetch-data"),n()},n=()=>{t.value&&(t.value.destroy(),t.value=null),e.form={},e.dialogFormVisible=!1};return _({showEdit:w}),(a,o)=>{const s=f("el-button"),l=f("el-drawer");return i(e).dialogFormVisible?(T(),A(l,{key:0,modelValue:i(e).dialogFormVisible,"onUpdate:modelValue":o[0]||(o[0]=c=>i(e).dialogFormVisible=c),title:i(e).title,size:"80%",onOpened:x,onClose:n},{footer:r(()=>[p(s,{onClick:n},{default:r(()=>[g("取 消")]),_:1}),p(s,{type:"primary",onClick:k},{default:r(()=>[g("确 定")]),_:1})]),default:r(()=>[O("div",{ref_key:"formRef",ref:d},null,512)]),_:1},8,["modelValue","title"])):P("",!0)}}});export{J as _};
