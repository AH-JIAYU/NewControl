
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{f as N,J as T,A as w,Z as J,r as O,q as H,G as y,s as $,h as m,o as u,c as _,a as i,w as n,b as v,k as o,a0 as j,a1 as z,l as h,i as b,M as A,an as U,y as D,e as q,H as F,_ as G}from"./index-DMKx6SnE.js";import{_ as R}from"./index.vue_vue_type_script_setup_true_lang-B4P5GnXw.js";import Z from"./index-BmSeuQJ-.js";import{a as K}from"./setting_permissions-CloJfLQU.js";import{a as Q}from"./menu-96Ri86er.js";import{u as W}from"./useTabbar-Cjz128FT.js";import"./index-6t9r9Xay.js";const X={key:0},Y=N({name:"SettingPermissionsList",__name:"list",setup(I){const E=T(),S=W(),g=w();J("success",d);const e=O({loading:!1,tableAutoHeight:!1,formMode:"drawer",formModeProps:{visible:!1,menulev:1,path:"",auths:[],id:""},EditProps:{visible:!1},search:{title:""},dataList:[]});H(()=>{d(),e.value.formMode==="router"&&y.on("get-data-list",()=>{d()})}),$(()=>{e.value.formMode==="router"&&y.off("get-data-list")});function M(t,s){t.forEach(a=>{a.children&&a.children.length>0&&(a.auths=M(a.children,s));const r=s.filter(f=>f.menu===a.name);return a.auths=r,[]})}async function d(){e.value.loading=!0;const t=await K.list(),s=await Q.list({type:"normal"});if(M(s.data,t.data),e.value.dataList=s.data,e.value.loading=!1,e.value.formModeProps.id){const a=P(e.value.dataList,e.value.formModeProps.id);e.value.formModeProps.auths=JSON.stringify(a.auths)}}function P(t,s){for(const a of t){if(a.id===s)return a;if(a.children){const r=P(a.children,s);if(r)return r}}return null}function k(){e.value.EditProps.id=11,e.value.EditProps.visible=!0,e.value.EditProps.row=JSON.stringify({})}function C(t){e.value.formMode==="router"?g.settings.tabbar.enable&&g.settings.tabbar.mergeTabsBy!=="activeMenu"?S.open({name:"multilevel_menu_examplePermissionsEdit",params:{id:t.id,menulev:t.menuLevel,path:t.path,auths:JSON.stringify(t.auths)}}):E.push({name:"multilevel_menu_examplePermissionsEdit",params:{id:t.id,menulev:t.menuLevel,path:t.path,auths:JSON.stringify(t.auths)}}):(e.value.formModeProps.id=t.id,e.value.formModeProps.auths=JSON.stringify(t.auths),e.value.formModeProps.visible=!0)}return(t,s)=>{const a=U,r=D,f=m("ElButton"),L=m("ElSpace"),p=m("ElTableColumn"),x=m("el-tag"),B=m("ElTable"),V=q;return u(),_("div",{class:A({"absolute-container":o(e).tableAutoHeight})},[i(a,{title:"权限管理管理"}),i(V,null,{default:n(()=>[i(L,{wrap:""},{default:n(()=>[i(f,{type:"primary",size:"default",onClick:k},{icon:n(()=>[i(r,{name:"i-ep:plus"})]),default:n(()=>[v(" 新增按钮权限 ")]),_:1})]),_:1}),i(B,{data:o(e).dataList,"row-key":"id",stripe:"","highlight-current-row":"","default-expand-all":"",border:"",style:{lineHeight:"normal"}},{default:n(()=>[i(p,{prop:"meta.title",width:"300",label:"模块"}),i(p,{label:"权限"},{default:n(({row:l})=>[(u(!0),_(j,null,z(l.auths,c=>(u(),b(x,{key:c.id,type:"primary"},{default:n(()=>[v(F(c.label),1)]),_:2},1024))),128))]),_:1}),i(p,{label:"操作",width:"250",align:"center",fixed:"right"},{default:n(l=>[l.row.menuLevel>2&&l.row.auths.length?(u(),_("div",X,[i(f,{type:"primary",size:"small",plain:"",onClick:c=>C(l.row)},{default:n(()=>[v(" 详情 ")]),_:2},1032,["onClick"])])):h("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),o(e).formMode==="dialog"||o(e).formMode==="drawer"?(u(),b(R,{key:0,id:o(e).formModeProps.id,modelValue:o(e).formModeProps.visible,"onUpdate:modelValue":s[0]||(s[0]=l=>o(e).formModeProps.visible=l),path:o(e).formModeProps.path,auths:o(e).formModeProps.auths,menulev:o(e).formModeProps.menulev,mode:o(e).formMode,onSuccess:d},null,8,["id","modelValue","path","auths","menulev","mode"])):h("",!0),o(e).EditProps.visible?(u(),b(Z,{key:1,modelValue:o(e).EditProps.visible,"onUpdate:modelValue":s[1]||(s[1]=l=>o(e).EditProps.visible=l),onSuccess:d},null,8,["modelValue"])):h("",!0)],2)}}}),ne=G(Y,[["__scopeId","data-v-43cbfd42"]]);export{ne as default};
