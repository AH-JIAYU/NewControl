
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{f as v,g as G,r as l,q as U,E as w,i as r,s as q,t as $,l as a,o as _,c as h,a as i,w as u,F as k,G as E,au as z,a4 as J,a5 as K,n as A,j as H,b as Q,_ as W}from"./index-C3PJOLdt.js";import{u as X}from"./tenantMenu-DM0cu3TL.js";import{u as Y}from"./tenantButtonPermission-CM11j0rz.js";const B={list:()=>v.get("/version/get/getVersionList"),detail:n=>v.get("setting/version_management/detail",{params:{id:n},baseURL:"/mock/"}),create:n=>v.post("version/insert/insertVersion",n),edit:n=>v.post("version/update/updateVersion",n),delete:n=>v.delete(`version/delete/deleteVersion/${n}`)},Z={class:"custom-tree-node"},ee={class:"menu"},te={class:"permission"},ne=G({__name:"index",props:["id","row"],setup(n,{expose:M}){const b=n,C=X(),F=Y(),s=l(!1),d=l(),I=l(),x=l([]),p=l([]),c=l([]),t=l({id:b.id,name:"",code:"",versionMenuId:[],versionButtonId:[]}),S=l({name:[{required:!0,message:"请输入版本",trigger:"blur"}]});U(async()=>{t.value.id!==""&&await D(),x.value=await C.gettenantMenu,p.value=await F.getTenantPermissions,s.value=!1});async function D(){s.value=!0,c.value=JSON.parse(b.row),t.value.name=c.value.name,t.value.remark=c.value.remark,g(c.value.menuVOList.data),P(c.value.buttonVOList),s.value=!1}function g(o){for(const e of o)t.value.versionMenuId.push(e.id),e.children&&g(e.children)}function P(o){for(const e of o)t.value.versionButtonId.push(e.id),e.children&&g(e.children)}function V(o){return p==null?void 0:p.value.filter(e=>o===e.menuId)}return M({submit(){return t.value.versionMenuId=I.value.getCheckedKeys(!1),new Promise(o=>{t.value.id===""?d.value&&d.value.validate(e=>{e&&(s.value=!0,B.create(t.value).then(()=>{w.success({message:"新增成功",center:!0}),s.value=!1,o()}))}):d.value&&d.value.validate(e=>{e&&(s.value=!0,B.edit(t.value).then(()=>{w.success({message:"编辑成功",center:!0}),s.value=!1,o()}))})})}}),(o,e)=>{const R=r("ElInput"),y=r("ElFormItem"),L=r("ElCheckbox"),N=r("ElCheckboxGroup"),O=r("el-tree"),T=r("ElForm"),j=q("loading");return $((_(),h("div",null,[i(T,{ref_key:"formRef",ref:d,model:a(t),rules:a(S),"label-width":"120px","label-suffix":"："},{default:u(()=>[i(y,{label:"版本",prop:"name"},{default:u(()=>[i(R,{modelValue:a(t).name,"onUpdate:modelValue":e[0]||(e[0]=m=>a(t).name=m),placeholder:"请输入版本"},null,8,["modelValue"])]),_:1}),i(y,{label:"权限"},{default:u(()=>[i(O,{ref_key:"treeRef",ref:I,data:a(x),style:{width:"100%"},"default-checked-keys":a(t).versionMenuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"","default-expand-all":"","highlight-current":"",border:""},{default:u(({data:m})=>[k("div",Z,[k("div",ee,E(m.meta.title),1),k("div",te,[V(m.id).length?(_(),h("div",{key:0,class:"buttonId",onClick:e[2]||(e[2]=z(()=>{},["stop"]))},[i(N,{modelValue:a(t).versionButtonId,"onUpdate:modelValue":e[1]||(e[1]=f=>a(t).versionButtonId=f)},{default:u(()=>[(_(!0),h(J,null,K(V(m.id),f=>(_(),H(L,{key:f.id,value:f.id},{default:u(()=>[Q(E(f.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):A("",!0)])])]),_:1},8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model","rules"])])),[[j,a(s)]])}}}),oe=W(ne,[["__scopeId","data-v-8b4b3280"]]),re=Object.freeze(Object.defineProperty({__proto__:null,default:oe},Symbol.toStringTag,{value:"Module"}));export{oe as D,B as a,re as i};
