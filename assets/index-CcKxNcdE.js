
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{f as P,r as s,q,ao as b,h as l,ap as G,ai as U,k as o,o as m,c as p,a as r,w as n,p as f,H as y,aA as A,a0 as H,a1 as K,l as L,i as S,b as T,_ as $}from"./index-DEkb9qM_.js";import{a as _}from"./setting_role-BjzUHurx.js";import{a as j}from"./menu-CQf6QKmq.js";import{a as z}from"./setting_permissions-BCPo_SsI.js";const J={class:"custom-tree-node"},O={class:"menu"},Q={class:"permission"},W=P({__name:"index",props:{id:{default:""}},setup(w,{expose:E}){const C=w,c=s(!1),i=s(),v=s(),k=s([]),h=s([]),a=s({id:C.id,role:"",menu:[],permission:[]}),V=s({role:[{required:!0,message:"请输入角色吗",trigger:"blur"}]});q(async()=>{a.value.id!==""&&await I();const t=await j.list({type:"normal"});k.value=t.data;const{data:e}=await z.list();h.value=e,c.value=!1});async function I(){c.value=!0;const t=await _.detail(a.value.id);c.value=!1,a.value=t.data}function g(t){return h.value.filter(e=>t===e.menuId)}return E({submit(){return a.value.menu=v.value.getCheckedKeys(!1),new Promise(t=>{a.value.id===""?i.value&&i.value.validate(e=>{e&&_.create(a.value).then(()=>{b.success({message:"模拟新增成功",center:!0}),t()})}):i.value&&i.value.validate(e=>{e&&_.edit(a.value).then(()=>{b.success({message:"模拟编辑成功",center:!0}),t()})})})}}),(t,e)=>{const D=l("ElInput"),x=l("ElFormItem"),F=l("ElCheckbox"),R=l("ElCheckboxGroup"),B=l("el-tree"),M=l("ElForm"),N=G("loading");return U((m(),p("div",null,[r(M,{ref_key:"formRef",ref:i,model:o(a),rules:o(V),"label-width":"120px","label-suffix":"："},{default:n(()=>[r(x,{label:"角色码",prop:"role"},{default:n(()=>[r(D,{modelValue:o(a).role,"onUpdate:modelValue":e[0]||(e[0]=u=>o(a).role=u),placeholder:"请输入角色码"},null,8,["modelValue"])]),_:1}),r(x,{label:"角色码",prop:"role"},{default:n(()=>[r(B,{ref_key:"treeRef",ref:v,data:o(k),style:{width:"100%"},"default-checked-keys":o(a).menu,"default-expanded-keys":[],"node-key":"id","show-checkbox":"","default-expand-all":"","highlight-current":"",border:""},{default:n(({data:u})=>[f("div",J,[f("div",O,y(u.meta.title),1),f("div",Q,[g(u.id).length?(m(),p("div",{key:0,class:"permissions",onClick:e[2]||(e[2]=A(()=>{},["stop"]))},[r(R,{modelValue:o(a).permission,"onUpdate:modelValue":e[1]||(e[1]=d=>o(a).permission=d)},{default:n(()=>[(m(!0),p(H,null,K(g(u.id),d=>(m(),S(F,{key:d.Permission,value:d.id},{default:n(()=>[T(y(d.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):L("",!0)])])]),_:1},8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model","rules"])])),[[N,o(c)]])}}}),ae=$(W,[["__scopeId","data-v-5c6e4c7e"]]);export{ae as default};
