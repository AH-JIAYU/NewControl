
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{f as q,aF as G,r as s,s as U,ao as b,h as a,ap as A,ai as J,k as t,o as m,c as f,a as l,w as r,q as p,I as w,aA as K,a1 as L,a2 as O,l as T,i as j,b as z,_ as H}from"./index-BGbxCPS3.js";import{a as y}from"./setting_role-Cl1FbKAk.js";import{u as Q}from"./buttonPermission-C34j4gqu.js";import"./setting_permissions-CPvh7Da6.js";const W={class:"custom-tree-node"},X={class:"menu"},Y={class:"permission"},Z=q({__name:"index",props:["id","row"],setup(E,{expose:I}){const _=E,C=G(),V=Q(),c=s(!1),n=s(),v=s(),k=s([]),h=s([]),e=s({id:_.id,role:"",menuId:[],permissions:[]}),F=s({role:[{required:!0,message:"请输入角色吗",trigger:"blur"}]});U(async()=>{e.value.id!==""&&await R(),k.value=C.routesRaw,h.value=await V.getPermissions,c.value=!1});async function R(){c.value=!0,e.value=JSON.parse(_.row),c.value=!1}function g(i){return h.value.filter(o=>i===o.menuId)}return I({submit(){return e.value.menuId=v.value.getCheckedKeys(!1),new Promise(i=>{e.value.id===""?n.value&&n.value.validate(o=>{o&&y.create(e.value).then(()=>{b.success({message:"新增成功",center:!0}),i()})}):n.value&&n.value.validate(o=>{o&&y.edit(e.value).then(()=>{b.success({message:"编辑成功",center:!0}),i()})})})}}),(i,o)=>{const D=a("ElInput"),x=a("ElFormItem"),P=a("ElCheckbox"),B=a("ElCheckboxGroup"),N=a("el-tree"),S=a("ElForm"),M=A("loading");return J((m(),f("div",null,[l(S,{ref_key:"formRef",ref:n,model:t(e),rules:t(F),"label-width":"120px","label-suffix":"："},{default:r(()=>[l(x,{label:"角色码",prop:"role"},{default:r(()=>[l(D,{modelValue:t(e).role,"onUpdate:modelValue":o[0]||(o[0]=u=>t(e).role=u),placeholder:"请输入角色码"},null,8,["modelValue"])]),_:1}),l(x,{label:"权限"},{default:r(()=>[l(N,{ref_key:"treeRef",ref:v,data:t(k),style:{width:"100%"},"default-checked-keys":t(e).menuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"","default-expand-all":"","highlight-current":"",border:""},{default:r(({data:u})=>[p("div",W,[p("div",X,w(u.meta.title),1),p("div",Y,[g(u.id).length?(m(),f("div",{key:0,class:"permissions",onClick:o[2]||(o[2]=K(()=>{},["stop"]))},[l(B,{modelValue:t(e).permissions,"onUpdate:modelValue":o[1]||(o[1]=d=>t(e).permissions=d)},{default:r(()=>[(m(!0),f(L,null,O(g(u.id),d=>(m(),j(P,{key:d.Permission,value:d.key},{default:r(()=>[z(w(d.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):T("",!0)])])]),_:1},8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model","rules"])])),[[M,t(c)]])}}}),se=H(Z,[["__scopeId","data-v-994576a3"]]);export{se as default};
