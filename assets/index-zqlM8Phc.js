
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{f as m,g as N,aG as j,r as a,A as G,ao as w,i as n,ap as O,ai as T,l as s,o as p,c as v,a as l,w as r,p as _,C as I,au as q,a0 as z,a1 as A,n as J,j as K,b as $,_ as H}from"./index-C4wi2QcV.js";import{u as Q}from"./buttonPermission-mJNlyucR.js";const E={list:o=>m.get("setting/version_management/list",{baseURL:"/mock/",data:o}),detail:o=>m.get("setting/version_management/detail",{params:{id:o},baseURL:"/mock/"}),create:o=>m.post("/version/insert/insertVersion",o),edit:o=>m.post("setting/version_management/edit",o,{baseURL:"/mock/"}),delete:o=>m.post("setting/version_management/delete",{id:o},{baseURL:"/mock/"})},W={class:"custom-tree-node"},X={class:"menu"},Y={class:"permission"},Z=N({__name:"index",props:["id","row"],setup(o,{expose:C}){const g=o,R=j(),V=Q(),f=a(!1),i=a(),k=a(),b=a([]),h=a([]),e=a({id:g.id,name:"",versionMenuId:[],versionButtonId:[]}),B=a({name:[{required:!0,message:"请输入角色码",trigger:"blur"}]});G(async()=>{e.value.id!==""&&await M(),b.value=R.routesRaw,h.value=await V.getPermissions,f.value=!1});async function M(){f.value=!0,e.value=JSON.parse(g.row),f.value=!1}function x(u){return h.value.filter(t=>u===t.versionMenuId)}return C({submit(){return e.value.versionMenuId=k.value.getCheckedKeys(!1),new Promise(u=>{e.value.id===""?i.value&&i.value.validate(t=>{t&&E.create(e.value).then(()=>{w.success({message:"新增成功",center:!0}),u()})}):i.value&&i.value.validate(t=>{t&&E.edit(e.value).then(()=>{w.success({message:"编辑成功",center:!0}),u()})})})}}),(u,t)=>{const D=n("ElInput"),y=n("ElFormItem"),P=n("ElCheckbox"),F=n("ElCheckboxGroup"),S=n("el-tree"),U=n("ElForm"),L=O("loading");return T((p(),v("div",null,[l(U,{ref_key:"formRef",ref:i,model:s(e),rules:s(B),"label-width":"120px","label-suffix":"："},{default:r(()=>[l(y,{label:"版本",prop:"name"},{default:r(()=>[l(D,{modelValue:s(e).name,"onUpdate:modelValue":t[0]||(t[0]=d=>s(e).name=d),placeholder:"请输入版本"},null,8,["modelValue"])]),_:1}),l(y,{label:"权限"},{default:r(()=>[l(S,{ref_key:"treeRef",ref:k,data:s(b),style:{width:"100%"},"default-checked-keys":s(e).versionMenuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"","default-expand-all":"","highlight-current":"",border:""},{default:r(({data:d})=>[_("div",W,[_("div",X,I(d.meta.title),1),_("div",Y,[x(d.id).length?(p(),v("div",{key:0,class:"versionButtonId",onClick:t[2]||(t[2]=q(()=>{},["stop"]))},[l(F,{modelValue:s(e).versionButtonId,"onUpdate:modelValue":t[1]||(t[1]=c=>s(e).versionButtonId=c)},{default:r(()=>[(p(!0),v(z,null,A(x(d.id),c=>(p(),K(P,{key:c.Permission,value:c.key},{default:r(()=>[$(I(c.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):J("",!0)])])]),_:1},8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model","rules"])])),[[L,s(f)]])}}}),ee=H(Z,[["__scopeId","data-v-fa57aae6"]]),se=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"}));export{ee as D,E as a,se as i};
