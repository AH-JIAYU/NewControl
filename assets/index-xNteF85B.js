
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{g as M,cn as q,r as s,q as U,E as x,i as a,s as j,t as J,l as o,o as f,c as p,a as l,w as r,F as _,G as w,au as K,a4 as L,a5 as O,n as T,j as z,b as A,_ as H}from"./index-zX-UbP25.js";import{a as y}from"./setting_role-DJGbejQF.js";import{u as Q}from"./buttonPermission-Ca0xU67J.js";import"./setting_permissions-Cv89LUfz.js";const W={class:"custom-tree-node"},X={class:"menu"},Y={class:"permission"},Z=M({__name:"index",props:["id","row"],setup(E,{expose:C}){const v=E,I=q(),V=Q(),c=s(!1),n=s(),k=s(),g=s([]),m=s([]),e=s({id:v.id??null,role:"",menuId:[],permissions:[],page:1,limit:10,roleName:"",remark:""}),F=s({role:[{required:!0,message:"请输入角色吗",trigger:"blur"}]});U(async()=>{e.value.id!==""&&await R(),g.value=I.routesRaw,m.value=await V.getPermissions,c.value=!1});async function R(){c.value=!0,e.value=JSON.parse(v.row),c.value=!1}function h(u){return m==null?void 0:m.value.filter(t=>u===t.menuId)}return C({submit(){return e.value.menuId=k.value.getCheckedKeys(!1),new Promise(u=>{e.value.id===""?n.value&&n.value.validate(t=>{t&&y.create(e.value).then(()=>{x.success({message:"新增成功",center:!0}),u()})}):n.value&&n.value.validate(t=>{t&&y.edit(e.value).then(()=>{x.success({message:"编辑成功",center:!0}),u()})})})}}),(u,t)=>{const N=a("ElInput"),b=a("ElFormItem"),P=a("ElCheckbox"),B=a("ElCheckboxGroup"),D=a("el-tree"),S=a("ElForm"),G=j("loading");return J((f(),p("div",null,[l(S,{ref_key:"formRef",ref:n,model:o(e),rules:o(F),"label-width":"120px","label-suffix":"："},{default:r(()=>[l(b,{label:"角色码",prop:"role"},{default:r(()=>[l(N,{modelValue:o(e).role,"onUpdate:modelValue":t[0]||(t[0]=i=>o(e).role=i),placeholder:"请输入角色码"},null,8,["modelValue"])]),_:1}),l(b,{label:"权限"},{default:r(()=>[l(D,{ref_key:"treeRef",ref:k,data:o(g),style:{width:"100%"},"default-checked-keys":o(e).menuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"","default-expand-all":"","highlight-current":"",border:""},{default:r(({data:i})=>[_("div",W,[_("div",X,w(i.meta.title),1),_("div",Y,[h(i.id).length?(f(),p("div",{key:0,class:"permissions",onClick:t[2]||(t[2]=K(()=>{},["stop"]))},[l(B,{modelValue:o(e).permissions,"onUpdate:modelValue":t[1]||(t[1]=d=>o(e).permissions=d)},{default:r(()=>[(f(!0),p(L,null,O(h(i.id),d=>(f(),z(P,{key:d.Permission,value:d.key},{default:r(()=>[A(w(d.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):T("",!0)])])]),_:1},8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model","rules"])])),[[G,o(c)]])}}}),se=H(Z,[["__scopeId","data-v-c45abad8"]]);export{se as default};
