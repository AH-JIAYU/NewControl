
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://fantastic-admin.gitee.io
 * Github https://fantastic-admin.github.io
 */

import{f as P,r as s,q,ao as y,h as l,ap as G,ai as S,k as t,o as m,c as p,a as r,w as n,p as _,H as w,az as U,a0 as z,a1 as H,l as J,i as K,b as L,_ as O}from"./index-BEQOMaLP.js";import{a as E}from"./setting_role-BHpzAgUL.js";import{a as T}from"./menu-FZieu2Kg.js";import{a as $}from"./setting_permissions--1DM7Ra6.js";const j={class:"custom-tree-node"},A={class:"menu"},Q={class:"permission"},W=P({__name:"index",props:["id","row","mode"],setup(C,{expose:I}){const v=C,c=s(!1),i=s(),k=s(),h=s([]),g=s([]),a=s({id:v.id,role:"",menuId:[],permission:[]}),V=s({role:[{required:!0,message:"请输入角色吗",trigger:"blur"}]});q(async()=>{a.value.id!==""&&await D();const o=await T.list({type:"normal"});h.value=o.data;const{data:e}=await $.list();g.value=e,c.value=!1});async function D(){c.value=!0,a.value=JSON.parse(v.row),c.value=!1}function x(o){return g.value.filter(f=>o===f.menuId)}return I({submit(){return a.value.menuId=k.value.getCheckedKeys(!1),new Promise(o=>{a.value.id===""?i.value&&i.value.validate(e=>{e&&E.create(a.value).then(()=>{y.success({message:"模拟新增成功",center:!0}),o()})}):i.value&&i.value.validate(e=>{e&&E.edit(a.value).then(()=>{y.success({message:"模拟编辑成功",center:!0}),o()})})})}}),(o,e)=>{const f=l("ElInput"),b=l("ElFormItem"),F=l("ElCheckbox"),N=l("ElCheckboxGroup"),R=l("el-tree"),B=l("ElForm"),M=G("loading");return S((m(),p("div",null,[r(B,{ref_key:"formRef",ref:i,model:t(a),rules:t(V),"label-width":"120px","label-suffix":"："},{default:n(()=>[r(b,{label:"角色码",prop:"role"},{default:n(()=>[r(f,{modelValue:t(a).role,"onUpdate:modelValue":e[0]||(e[0]=d=>t(a).role=d),placeholder:"请输入角色码"},null,8,["modelValue"])]),_:1}),r(b,{label:"权限"},{default:n(()=>[r(R,{ref_key:"treeRef",ref:k,data:t(h),style:{width:"100%"},"default-checked-keys":t(a).menuId,"default-expanded-keys":[],"node-key":"id","show-checkbox":"","default-expand-all":"","highlight-current":"",border:""},{default:n(({data:d})=>[_("div",j,[_("div",A,w(d.meta.title),1),_("div",Q,[x(d.id).length?(m(),p("div",{key:0,class:"permissions",onClick:e[2]||(e[2]=U(()=>{},["stop"]))},[r(N,{modelValue:t(a).permission,"onUpdate:modelValue":e[1]||(e[1]=u=>t(a).permission=u)},{default:n(()=>[(m(!0),p(z,null,H(x(d.id),u=>(m(),K(F,{key:u.Permission,value:u.key},{default:n(()=>[L(w(u.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):J("",!0)])])]),_:1},8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model","rules"])])),[[M,t(c)]])}}}),ae=O(W,[["__scopeId","data-v-fb2adaef"]]);export{ae as default};
